# GitHub Action: Veloera 自動簽到

name: Veloera Check-in

on:
  workflow_dispatch: # 允許手動觸發
  schedule:
    # 每日台北時間早上 10 點 (UTC+8) 執行，即 UTC 時間凌晨 2 點
    - cron: "0 2 * * *"

jobs:
  check-in:
    runs-on: ubuntu-latest
    name: Veloera 簽到任務

    steps:
      - name: 簽出程式碼
        uses: actions/checkout@v4

      - name: 設定 Python 環境
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: "pip"
          cache-dependency-path: "_CRONJOBS/veloera_sign/requirements.txt"

      - name: 安裝依賴套件
        run: pip install -r _CRONJOBS/veloera_sign/requirements.txt

      - name: 執行簽到腳本
        # 註解：此腳本會自動讀取所有以 "VELOERA_AUTOSIGN_" 開頭的 Secrets
        # 您必須在儲存庫的 Settings -> Secrets and variables -> Actions 中設定好這些 Secrets
        env:
          # 將所有 VELOERA_AUTOSIGN_ 開頭的 secrets 傳遞給腳本
          ${{ toJSON(secrets) }}: ${{ toJSON(secrets) }}
        run: |
          for secret_name in $(env | grep VELOERA_AUTOSIGN_ | cut -d= -f1); do
            export $secret_name
          done
          python _CRONJOBS/veloera_sign/checkin.py
