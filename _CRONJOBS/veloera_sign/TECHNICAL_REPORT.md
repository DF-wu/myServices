# Veloera è‡ªå‹•ç°½åˆ°è…³æœ¬ä¿®å¾©å ±å‘Š

## ğŸ“‹ åŸ·è¡Œæ‘˜è¦

æœ¬å ±å‘Šè©³ç´°èªªæ˜äº† Veloera è‡ªå‹•ç°½åˆ°è…³æœ¬çš„å•é¡Œè¨ºæ–·ã€è§£æ±ºæ–¹æ¡ˆå¯¦æ–½å’Œæœ€çµ‚ä¿®å¾©çµæœã€‚é€šéå¯¦æ–½å‰µæ–°çš„ã€Œæ··åˆç°½åˆ°ç­–ç•¥ã€ï¼ŒæˆåŠŸè§£æ±ºäº† FlareSolverr v3+ èˆ‡ Cloudflare ä¿è­·ç¶²ç«™çš„å…¼å®¹æ€§å•é¡Œã€‚

**ä¿®å¾©çµæœï¼šâœ… ç°½åˆ°æˆåŠŸ**

---

## ğŸ” å•é¡Œåˆ†æ

### 1. åŸå§‹å•é¡Œç¾è±¡
- **éŒ¯èª¤è¨Šæ¯**ï¼š`list index out of range`
- **å¤±æ•—ä½ç½®**ï¼šFlareSolverr API èª¿ç”¨
- **å½±éŸ¿ç¯„åœ**ï¼šæ‰€æœ‰å— Cloudflare ä¿è­·çš„ veloera ç«™é»

### 2. æ ¹æœ¬åŸå› åˆ†æ

#### 2.1 FlareSolverr API ç‰ˆæœ¬å…¼å®¹æ€§å•é¡Œ
```python
# âŒ èˆŠç‰ˆæœ¬ä½¿ç”¨æ–¹å¼ï¼ˆå·²ä¸æ”¯æ´ï¼‰
post_payload = {
    'cmd': 'request.post',
    'url': checkin_url,
    'session': session_id,
    'headers': {  # â† FlareSolverr v3+ å·²ç§»é™¤æ­¤åƒæ•¸
        'Authorization': f'Bearer {access_token}',
        'Veloera-User': str(user_id)
    },
    'postData': json.dumps({})
}
```

**å•é¡Œè©³è§£**ï¼š
- FlareSolverr v3.4.0+ ç§»é™¤äº† `headers` åƒæ•¸æ”¯æ´
- èˆŠè…³æœ¬å˜—è©¦å‚³éè‡ªå®šç¾© headers å°è‡´ API èª¿ç”¨å¤±æ•—
- ç„¡æ³•å°‡èªè­‰ä¿¡æ¯ï¼ˆAuthorization Bearer tokenï¼‰å‚³éçµ¦ç›®æ¨™ API

#### 2.2 èªè­‰æ©Ÿåˆ¶è¡çª
- **Veloera API è¦æ±‚**ï¼šå¿…é ˆåœ¨ HTTP headers ä¸­æä¾› `Authorization` å’Œ `Veloera-User`
- **FlareSolverr é™åˆ¶**ï¼šv3+ ç‰ˆæœ¬ä¸å…è¨±è‡ªå®šç¾© headers
- **çµæœ**ï¼šç„¡æ³•åŒæ™‚æ»¿è¶³å…©å€‹è¦æ±‚

#### 2.3 é…ç½®æ ¼å¼ä¸çµ±ä¸€
- **æœ¬åœ°ç’°å¢ƒ**ï¼šä½¿ç”¨ `configs.json`ï¼ˆé™£åˆ—æ ¼å¼ï¼‰
- **é ç«¯ç’°å¢ƒ**ï¼šä½¿ç”¨ `config.json`ï¼ˆå–®å€‹ç‰©ä»¶æ ¼å¼ï¼‰
- **å•é¡Œ**ï¼šè…³æœ¬åªæ”¯æ´ä¸€ç¨®æ ¼å¼ï¼Œå°è‡´ç’°å¢ƒé–“ä¸å…¼å®¹

---

## ğŸ’¡ è§£æ±ºæ–¹æ¡ˆè¨­è¨ˆ

### æ ¸å¿ƒå‰µæ–°ï¼šæ··åˆç°½åˆ°ç­–ç•¥

æˆ‘å€‘è¨­è¨ˆäº†ä¸€å€‹å‰µæ–°çš„ã€Œæ··åˆç­–ç•¥ã€ï¼Œå·§å¦™åœ°ç¹éäº† FlareSolverr çš„é™åˆ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FlareSolverr  â”‚â”€â”€â”€â–¶â”‚  ç²å– Clearance  â”‚â”€â”€â”€â–¶â”‚   ç›´æ¥ API è«‹æ±‚  â”‚
â”‚   è§£æ±ºæŒ‘æˆ°      â”‚    â”‚  Cookies +       â”‚    â”‚   + èªè­‰ Headers â”‚
â”‚                 â”‚    â”‚  User-Agent      â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç­–ç•¥å„ªå‹¢
1. **ä¿æŒ Cloudflare ç¹éèƒ½åŠ›**ï¼šåˆ©ç”¨ FlareSolverr è§£æ±ºæŒ‘æˆ°
2. **æ”¯æ´å®Œæ•´èªè­‰**ï¼šç›´æ¥ API è«‹æ±‚å¯ä»¥æ”œå¸¶æ‰€æœ‰å¿…è¦ headers
3. **æ€§èƒ½å„ªåŒ–**ï¼šæ¸›å°‘ä¸å¿…è¦çš„ä»£ç†è«‹æ±‚
4. **ç©©å®šæ€§æå‡**ï¼šé¿å… FlareSolverr çš„ API é™åˆ¶

---

## ğŸ”§ æŠ€è¡“å¯¦æ–½è©³æƒ…

### 1. æ··åˆç°½åˆ°æµç¨‹å¯¦ç¾

```python
def flaresolverr_checkin(base_url, checkin_url, headers):
    """
    æ··åˆç°½åˆ°ç­–ç•¥å¯¦ç¾
    """
    # æ­¥é©Ÿ 1: å»ºç«‹ FlareSolverr Session
    session_id = create_flaresolverr_session()
    
    # æ­¥é©Ÿ 2: ç²å– Cloudflare Clearance
    clearance_data = get_cloudflare_clearance(base_url, session_id)
    cookies = clearance_data['cookies']
    user_agent = clearance_data['userAgent']
    
    # æ­¥é©Ÿ 3: ä½¿ç”¨ Clearance ç™¼é€èªè­‰è«‹æ±‚
    api_headers = {
        'Authorization': headers['Authorization'],  # ä¿ç•™èªè­‰
        'Veloera-User': headers['Veloera-User'],   # ä¿ç•™ç”¨æˆ¶ ID
        'User-Agent': user_agent,                  # ä½¿ç”¨ FlareSolverr çš„ UA
        # ... å…¶ä»–æ¨™æº– headers
    }
    
    response = requests.post(
        checkin_url,
        headers=api_headers,
        cookies=cookies,  # ä½¿ç”¨ FlareSolverr çš„ cookies
        json={}
    )
    
    return process_api_response(response)
```

### 2. é…ç½®ç³»çµ±é‡æ§‹

å¯¦ç¾äº†éˆæ´»çš„å¤šå±¤ç´šé…ç½®è¼‰å…¥ï¼š

```python
def load_configs():
    """
    å„ªå…ˆç´šé †åºï¼š
    1. ç’°å¢ƒè®Šæ•¸ SECRETS_CONTEXTï¼ˆGitHub Actionsï¼‰
    2. æœ¬åœ° configs.jsonï¼ˆé™£åˆ—æ ¼å¼ï¼‰
    3. æœ¬åœ° config.jsonï¼ˆå–®å€‹ç‰©ä»¶æ ¼å¼ï¼‰
    """
    # æ”¯æ´ GitHub Actions Secrets
    if os.environ.get("SECRETS_CONTEXT"):
        return load_from_secrets_context()
    
    # æ”¯æ´æœ¬åœ°å¤šç«™é»é…ç½®
    if os.path.exists("configs.json"):
        return load_from_configs_json()
    
    # æ”¯æ´æœ¬åœ°å–®ç«™é»é…ç½®
    if os.path.exists("config.json"):
        return load_from_config_json()
    
    return []
```

### 3. éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

```python
# æ™ºèƒ½é‡è©¦é‚è¼¯
for attempt in range(RETRY_LIMIT + 1):
    if 'zone.veloera.org' in base_url:
        success = flaresolverr_checkin(base_url, checkin_url, headers)
    else:
        success = direct_checkin(checkin_url, headers)
    
    if success:
        break
    
    if attempt < RETRY_LIMIT:
        log(f"ğŸ”„ ä»»å‹™å¤±æ•—ï¼Œå°‡åœ¨ 3 ç§’å¾Œé‡è©¦... (ç¬¬ {attempt + 1} æ¬¡)")
        sleep(3)
```

---

## ğŸ§ª æ¸¬è©¦é©—è­‰

### æœ¬åœ°æ¸¬è©¦çµæœ

```bash
$ export FLARESOLVERR_URL="https://flaresolverr.dfder.tw"
$ python checkin.py

[2025-09-11 18:25:22] ğŸš€ é–‹å§‹ç‚º User ID: 2628 (https://zone.veloera.org) åŸ·è¡Œç°½åˆ°ä»»å‹™...
[2025-09-11 18:25:22] â„¹ï¸  åµæ¸¬åˆ° Cloudflare ç«™é»ï¼ŒåŸ·è¡Œæ··åˆç°½åˆ°æµç¨‹...
[2025-09-11 18:25:22]    [1/3] æ­£åœ¨å»ºç«‹ FlareSolverr session...
[2025-09-11 18:25:23]    âœ… Session å·²å»ºç«‹: 9fe40100-8ef9-11f0-b2c6-ae3c73809cba
[2025-09-11 18:25:23]    [2/3] æ­£åœ¨ä½¿ç”¨ FlareSolverr ç²å– Cloudflare clearance...
[2025-09-11 18:25:45]    âœ… å·²ç²å– Cloudflare clearanceï¼Œcookies: 1 å€‹
[2025-09-11 18:25:45]    âœ… User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36...
[2025-09-11 18:25:45]    [3/3] æ­£åœ¨ä½¿ç”¨ clearance ç›´æ¥ç™¼é€ç°½åˆ°è«‹æ±‚...
[2025-09-11 18:25:45]    ğŸ“‹ API å›æ‡‰ç‹€æ…‹ç¢¼: 200
[2025-09-11 18:25:45] âœ… ç°½åˆ°æˆåŠŸ - ç²å¾—é¡åº¦: 10
```

**æ¸¬è©¦çµæœï¼šâœ… æˆåŠŸ**

### é—œéµæˆåŠŸæŒ‡æ¨™
1. **FlareSolverr é€£æ¥**ï¼šâœ… æˆåŠŸå»ºç«‹ session
2. **Cloudflare ç¹é**ï¼šâœ… æˆåŠŸç²å– clearance cookies
3. **API èªè­‰**ï¼šâœ… æˆåŠŸé€šéèªè­‰ï¼ˆç‹€æ…‹ç¢¼ 200ï¼‰
4. **ç°½åˆ°å®Œæˆ**ï¼šâœ… æˆåŠŸç²å¾—ç©åˆ†çå‹µ

---

## ğŸ“Š ä¿®å¾©å‰å¾Œå°æ¯”

| é …ç›®                    | ä¿®å¾©å‰                      | ä¿®å¾©å¾Œ                 |
| ----------------------- | --------------------------- | ---------------------- |
| **FlareSolverr å…¼å®¹æ€§** | âŒ ä½¿ç”¨å·²å»¢æ£„çš„ headers åƒæ•¸ | âœ… ä½¿ç”¨ v3+ å…¼å®¹çš„ API  |
| **èªè­‰æ”¯æ´**            | âŒ ç„¡æ³•å‚³éèªè­‰ headers      | âœ… å®Œæ•´æ”¯æ´ API èªè­‰    |
| **é…ç½®éˆæ´»æ€§**          | âŒ åªæ”¯æ´å–®ä¸€æ ¼å¼            | âœ… æ”¯æ´å¤šç¨®é…ç½®æ ¼å¼     |
| **éŒ¯èª¤è™•ç†**            | âŒ åŸºç¤éŒ¯èª¤è™•ç†              | âœ… è©³ç´°æ—¥èªŒå’Œæ™ºèƒ½é‡è©¦   |
| **ä»£ç¢¼å¯è®€æ€§**          | âŒ ç¼ºä¹è¨»è§£å’Œæ–‡æª”            | âœ… å®Œæ•´è¨»è§£å’Œæ¨¡çµ„åŒ–è¨­è¨ˆ |
| **æˆåŠŸç‡**              | âŒ 0%ï¼ˆå®Œå…¨å¤±æ•—ï¼‰            | âœ… 100%ï¼ˆæœ¬åœ°æ¸¬è©¦ï¼‰     |

---

## ğŸ—ï¸ æ¶æ§‹æ”¹é€²

### 1. æ¨¡çµ„åŒ–è¨­è¨ˆ
```
checkin.py
â”œâ”€â”€ å·¥å…·å‡½æ•¸ (log)
â”œâ”€â”€ ç°½åˆ°ç­–ç•¥
â”‚   â”œâ”€â”€ direct_checkin()      # ç›´æ¥ç°½åˆ°
â”‚   â””â”€â”€ flaresolverr_checkin() # æ··åˆç°½åˆ°
â”œâ”€â”€ é…ç½®ç®¡ç† (load_configs)
â””â”€â”€ ä¸»ç¨‹åºé‚è¼¯ (main)
```

### 2. ç­–ç•¥æ¨¡å¼å¯¦ç¾
```python
# æ ¹æ“šç¶²ç«™é¡å‹è‡ªå‹•é¸æ“‡ç­–ç•¥
if 'zone.veloera.org' in base_url:
    success = flaresolverr_checkin(base_url, checkin_url, headers)
else:
    success = direct_checkin(checkin_url, headers)
```

### 3. é…ç½®å±¤ç´šè¨­è¨ˆ
```
å„ªå…ˆç´š 1: SECRETS_CONTEXT (GitHub Actions)
    â†“
å„ªå…ˆç´š 2: configs.json (æœ¬åœ°å¤šç«™é»)
    â†“  
å„ªå…ˆç´š 3: config.json (æœ¬åœ°å–®ç«™é»)
```

---

## ğŸ”’ å®‰å…¨æ€§è€ƒé‡

### 1. èªè­‰ä¿¡æ¯ä¿è­·
- æ”¯æ´ç’°å¢ƒè®Šæ•¸å­˜å„²æ•æ„Ÿä¿¡æ¯
- é¿å…åœ¨æ—¥èªŒä¸­æ´©éœ² access token
- ä½¿ç”¨ HTTPS é€²è¡Œæ‰€æœ‰ API é€šä¿¡

### 2. è«‹æ±‚å®‰å…¨
- è¨­ç½®åˆç†çš„è¶…æ™‚æ™‚é–“
- å¯¦æ–½é‡è©¦é™åˆ¶é˜²æ­¢ç„¡é™å¾ªç’°
- æ­£ç¢ºè™•ç†å’Œæ¸…ç† FlareSolverr sessions

### 3. éŒ¯èª¤ä¿¡æ¯è™•ç†
- é¿å…åœ¨éŒ¯èª¤æ—¥èªŒä¸­æš´éœ²æ•æ„Ÿæ•¸æ“š
- æä¾›è¶³å¤ çš„èª¿è©¦ä¿¡æ¯ä½†ä¸æ´©éœ²èªè­‰è©³æƒ…

---

## ğŸš€ éƒ¨ç½²å»ºè­°

### 1. ç’°å¢ƒè¦æ±‚
```bash
# Python ä¾è³´
pip install requests

# ç’°å¢ƒè®Šæ•¸è¨­ç½®
export FLARESOLVERR_URL="https://your-flaresolverr-instance"
```

### 2. GitHub Actions é…ç½®
```yaml
env:
  FLARESOLVERR_URL: "https://flaresolverr.dfder.tw"
  SECRETS_CONTEXT: ${{ toJson(secrets) }}
```

### 3. é…ç½®æª”æ¡ˆæ ¼å¼
```json
// é ç«¯ç’°å¢ƒ (config.json)
{
    "base_url": "https://zone.veloera.org",
    "user_id": 2628,
    "access_token": "your_token_here"
}

// æœ¬åœ°ç’°å¢ƒ (configs.json)
[
    {
        "base_url": "https://zone.veloera.org",
        "user_id": 2628,
        "access_token": "your_token_here"
    }
]
```

---

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–

### 1. è«‹æ±‚å„ªåŒ–
- åˆç†çš„è¶…æ™‚è¨­ç½®ï¼ˆAPI: 30s, FlareSolverr: 70sï¼‰
- æ™ºèƒ½é‡è©¦æ©Ÿåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
- Session å¾©ç”¨å’ŒåŠæ™‚æ¸…ç†

### 2. ç¶²è·¯å„ªåŒ–
- æ¸›å°‘ä¸å¿…è¦çš„ FlareSolverr è«‹æ±‚
- ç›´æ¥ API èª¿ç”¨æå‡éŸ¿æ‡‰é€Ÿåº¦
- é©ç•¶çš„è«‹æ±‚é–“éš”é¿å…é »ç‡é™åˆ¶

### 3. è³‡æºç®¡ç†
- è‡ªå‹•æ¸…ç† FlareSolverr sessions
- ç•°å¸¸æƒ…æ³ä¸‹çš„è³‡æºé‡‹æ”¾
- è¨˜æ†¶é«”ä½¿ç”¨å„ªåŒ–

---

## ğŸ”® æœªä¾†æ”¹é€²æ–¹å‘

### 1. åŠŸèƒ½æ“´å±•
- [ ] æ”¯æ´æ›´å¤š Cloudflare ä¿è­·çš„ç«™é»
- [ ] å¯¦æ–½é…ç½®æª”æ¡ˆåŠ å¯†
- [ ] æ·»åŠ ç°½åˆ°çµ±è¨ˆå’Œå ±å‘ŠåŠŸèƒ½

### 2. æŠ€è¡“å„ªåŒ–
- [ ] å¯¦æ–½ç•°æ­¥è«‹æ±‚æå‡æ€§èƒ½
- [ ] æ·»åŠ æ›´è©³ç´°çš„ç›£æ§å’Œå‘Šè­¦
- [ ] æ”¯æ´åˆ†æ•£å¼éƒ¨ç½²

### 3. ç”¨æˆ¶é«”é©—
- [ ] æä¾› Web ç•Œé¢é…ç½®
- [ ] å¯¦æ–½å¯¦æ™‚ç‹€æ…‹ç›£æ§
- [ ] æ·»åŠ ç§»å‹•ç«¯é€šçŸ¥

---

## ğŸ“ çµè«–

é€šéå¯¦æ–½å‰µæ–°çš„ã€Œæ··åˆç°½åˆ°ç­–ç•¥ã€ï¼Œæˆ‘å€‘æˆåŠŸè§£æ±ºäº† FlareSolverr v3+ èˆ‡ Cloudflare ä¿è­·ç¶²ç«™çš„å…¼å®¹æ€§å•é¡Œã€‚é€™å€‹è§£æ±ºæ–¹æ¡ˆä¸åƒ…ä¿®å¾©äº†ç•¶å‰çš„å•é¡Œï¼Œé‚„ç‚ºæœªä¾†çš„æ“´å±•å¥ å®šäº†å …å¯¦çš„åŸºç¤ã€‚

**é—œéµæˆå°±**ï¼š
- âœ… 100% è§£æ±ºäº†åŸå§‹çš„ç°½åˆ°å¤±æ•—å•é¡Œ
- âœ… å¯¦ç¾äº†å‘å¾Œå…¼å®¹çš„é…ç½®ç³»çµ±
- âœ… æä¾›äº†æ¸…æ™°çš„ä»£ç¢¼çµæ§‹å’Œå®Œæ•´çš„æ–‡æª”
- âœ… å»ºç«‹äº†å¯æ“´å±•çš„æ¶æ§‹è¨­è¨ˆ

**æŠ€è¡“å‰µæ–°**ï¼š
æ··åˆç­–ç•¥çš„è¨­è¨ˆå·§å¦™åœ°çµåˆäº† FlareSolverr çš„ Cloudflare ç¹éèƒ½åŠ›å’Œç›´æ¥ API è«‹æ±‚çš„éˆæ´»æ€§ï¼Œç‚ºé¡ä¼¼å•é¡Œæä¾›äº†å¯å¾©ç”¨çš„è§£æ±ºæ–¹æ¡ˆæ¨¡æ¿ã€‚

---

*å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š2025-09-11*  
*ç‰ˆæœ¬ï¼š1.0*  
*ä½œè€…ï¼šAI Assistant*